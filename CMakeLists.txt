cmake_minimum_required(VERSION 3.20)
if(WIN32)
    add_compile_options(/utf-8)
endif()
# è¨­å®š CMake æ”¿ç­–
cmake_policy(SET CMP0167 NEW)  # ä½¿ç”¨æ–°çš„ Boost æŸ¥æ‰¾æ–¹å¼

project(MTS VERSION 1.0.0 LANGUAGES CXX)

# C++ æ¨™æº–
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# ğŸ”§ æ–°å¢ï¼šé™¤éŒ¯æ¨¡å¼è¨­å®š
if(NOT CMAKE_BUILD_TYPE)
    set(CMAKE_BUILD_TYPE Debug)
endif()

# ğŸ”§ æ–°å¢ï¼šFIX é™¤éŒ¯é¸é …
option(ENABLE_FIX_DEBUG "Enable FIX protocol debug output" ON)
option(ENABLE_FIX_CHECKSUM_DEBUG "Enable FIX checksum debug output" ON)
option(ENABLE_FIX_PARSE_DEBUG "Enable FIX parsing debug output" ON)
option(ENABLE_FIX_SERIALIZE_DEBUG "Enable FIX serialization debug output" ON)
option(ENABLE_FIX_VALIDATION_DEBUG "Enable FIX validation debug output" ON)
option(ENABLE_FIX_FACTORY_DEBUG "Enable FIX factory debug output" ON)

# Windows ç‰¹å®šè¨­å®š
if(WIN32)
    add_definitions(-D_WIN32_WINNT=0x0601)  # Windows 7 ä»¥ä¸Š
    add_definitions(-DNOMINMAX)  # é¿å… Windows.h çš„ min/max å·¨é›†
endif()

# å°‹æ‰¾å¥—ä»¶
find_package(GTest CONFIG REQUIRED)
find_package(Boost REQUIRED COMPONENTS system thread)
find_package(nlohmann_json CONFIG REQUIRED)

# åŒ…å«ç›®éŒ„
include_directories(${PROJECT_SOURCE_DIR}/src)

# ğŸ”§ ä¿®æ­£ï¼šæ ¹æ“šé¸é …è¨­å®šç·¨è­¯å®šç¾©ï¼ˆç¬¦åˆ .cpp ä¸­çš„å·¨é›†åç¨±ï¼‰
# ğŸ”§ ä¿®æ­£ï¼šåˆ†åˆ¥æª¢æŸ¥æ¯å€‹ debug é¸é …
message(STATUS "=== FIX Debug Configuration ===")

# æª¢æŸ¥æ˜¯å¦æœ‰ä»»ä½• debug é¸é …å•Ÿç”¨
set(ANY_DEBUG_ENABLED FALSE)

if(ENABLE_FIX_DEBUG)
    add_definitions(-DENABLE_FIX_DEBUG)
    message(STATUS "  - General FIX debug: ON")
    set(ANY_DEBUG_ENABLED TRUE)
endif()

if(ENABLE_FIX_CHECKSUM_DEBUG)
    add_definitions(-DENABLE_FIX_CHECKSUM_DEBUG)
    message(STATUS "  - Checksum debug: ON")
    set(ANY_DEBUG_ENABLED TRUE)
endif()

if(ENABLE_FIX_PARSE_DEBUG)
    add_definitions(-DENABLE_FIX_PARSE_DEBUG)
    message(STATUS "  - Parse debug: ON")
    set(ANY_DEBUG_ENABLED TRUE)
endif()

if(ENABLE_FIX_SERIALIZE_DEBUG)
    add_definitions(-DENABLE_FIX_SERIALIZE_DEBUG)
    message(STATUS "  - Serialize debug: ON")
    set(ANY_DEBUG_ENABLED TRUE)
endif()

if(ENABLE_FIX_VALIDATION_DEBUG)
    add_definitions(-DENABLE_FIX_VALIDATION_DEBUG)
    message(STATUS "  - Validation debug: ON")
    set(ANY_DEBUG_ENABLED TRUE)
endif()

if(ENABLE_FIX_FACTORY_DEBUG)
    add_definitions(-DENABLE_FIX_FACTORY_DEBUG)
    message(STATUS "  - Factory debug: ON")
    set(ANY_DEBUG_ENABLED TRUE)
endif()

# é¡¯ç¤ºæ•´é«”ç‹€æ…‹
if(ANY_DEBUG_ENABLED)
    message(STATUS "ğŸ” FIX Debug mode: PARTIAL (some debug options enabled)")
else()
    message(STATUS "ğŸš€ FIX Production mode (all debug disabled)")
endif()

message(STATUS "Build Type: ${CMAKE_BUILD_TYPE}")
message(STATUS "=================================")

# å­ç›®éŒ„
add_subdirectory(src)
add_subdirectory(tests)
add_subdirectory(tools)